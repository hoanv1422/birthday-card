<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Thi·ªáp sinh nh·∫≠t ‚Äî Linh</title>
  <meta name="theme-color" content="#e11d48" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@600;700&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --card:#ffffff; --fg:#0f172a; --muted:#64748b;
      --accent:#e11d48;           /* h·ªìng ƒë·ªè */
      --accent-2:#fb7185;         /* h·ªìng nh·∫°t */
      --ring:rgba(225,29,72,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--fg);
      background:
        radial-gradient(1200px 600px at 20% -10%, #e11d4833, transparent 70%),
        radial-gradient(900px 500px at 100% 10%, #fb718522, transparent 70%),
        radial-gradient(800px 500px at 40% 100%, #22d3ee22, transparent 70%),
        var(--bg);
      overflow-x:hidden; -webkit-tap-highlight-color: transparent;
    }
    .wrap{min-height:100%; display:grid; place-items:center; padding:28px 16px;}
    .card{
      width:min(760px, 96vw); background:var(--card); border-radius:24px; padding:28px 22px;
      box-shadow:0 15px 45px rgba(2,6,23,.25), 0 0 0 1px rgba(255,255,255,.06);
      position:relative; isolation:isolate;
    }
    .ribbon{position:absolute; inset:auto 18px -14px auto; background:linear-gradient(90deg,var(--accent),var(--accent-2)); height:6px; width:120px; border-radius:6px; box-shadow:0 8px 20px rgba(225,29,72,.35)}
    header{display:flex; gap:16px; align-items:center; margin-bottom:12px;}
    .avatar{
      flex:0 0 auto; width:64px; height:64px; border-radius:50%; display:grid; place-items:center;
      background: radial-gradient(120% 100% at 30% 20%, var(--accent-2), var(--accent));
      color:#fff; font-weight:800; font-size:22px; user-select:none;
      box-shadow:0 10px 22px rgba(225,29,72,.35), inset 0 0 0 2px rgba(255,255,255,.22);
      animation: heartbeat 1.8s ease-in-out infinite;
    }
    @keyframes heartbeat{
      0%, 28%, 70%, 100%{ transform: scale(1); }
      14%, 56%{ transform: scale(1.06); }
    }
    .titles{flex:1 1 auto}
    .eyebrow{ text-transform:uppercase; letter-spacing:.16em; font-size:12px; color:var(--muted)}
    h1{
      margin:6px 0 0; font-size:clamp(26px, 5.6vw, 40px); line-height:1.1; font-weight:800; letter-spacing:.2px;
      font-family:"Playfair Display", Georgia, serif;
      background: linear-gradient(90deg, #0f172a, #111827 40%, var(--accent) 85%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .toLine{ margin:4px 0 0; color:#111827; font-weight:600; font-size:clamp(14px, 3.6vw, 16px); }

    .content{
      margin-top:16px; border-radius:18px; padding:18px 16px;
      background: linear-gradient(180deg, #f8fafc, #ffffff); border:1px solid #e2e8f0;
      box-shadow: inset 0 1px 0 #fff, 0 10px 24px rgba(2,6,23,.04);
    }
    blockquote{ margin:0; padding:0 0 0 14px; border-left:3px solid var(--accent); color:#0f172a; font-size:clamp(16px, 4vw, 18px); line-height:1.6; }
    .lead{ font-size:clamp(15px, 3.7vw, 17px); color:#0b1220; margin:10px 0 0; }

    .signature{ margin-top:18px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; border-top:1px dashed #e5e7eb; padding-top:14px; }
    .sig-name{ font-family:"Great Vibes","Segoe Script",cursive; font-size:clamp(24px, 6vw, 36px); color:#0f172a; }
    .sig-note{ color:var(--muted); font-size:14px }

    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin:14px 0 0; }
    .badge{ border:1px solid #e5e7eb; border-radius:999px; padding:8px 12px; background:#fff; font-size:13px; color:#0b1220; }

    .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:18px; align-items:center }
    .btn{
      appearance:none; border:1px solid transparent; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:700; font-size:15px;
      background:var(--accent); color:#fff; box-shadow:0 6px 16px rgba(225,29,72,.28); transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease, filter .2s ease; touch-action: manipulation;
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .btn.secondary{ background:#fff; color:#0f172a; border-color:#e5e7eb; box-shadow:0 6px 16px rgba(2,6,23,.06); }
    .btn.ghost{ background:transparent; color:#0f172a; border-color:#e5e7eb; }

    .url-input{
      flex:1 1 260px; min-width:220px; padding:12px 14px; border-radius:12px;
      border:1px solid #e5e7eb; outline:none;
      box-shadow: 0 0 0 0 var(--ring);
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    .url-input:focus{ border-color:#fda4af; box-shadow: 0 0 0 6px var(--ring); }

    .meta{ margin-top:10px; color:var(--muted); font-size:12px }

    /* Overlays */
    #confetti{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:0 }
    #heart-layer{ position:fixed; inset:0; pointer-events:none; z-index:1; overflow:hidden }

    /* Heart DOM piece */
    .heart{
      position:fixed; width:18px; height:18px; left:0; top:0; transform:translate(-50%,-50%) rotate(45deg);
      background: currentColor; color:#e11d48; border-radius:4px; opacity:.95; filter: drop-shadow(0 3px 6px rgba(225,29,72,.35));
      animation: floatHeart 2.2s ease-out forwards;
    }
    .heart::before, .heart::after{
      content:""; position:absolute; width:18px; height:18px; background: currentColor; border-radius:50%;
    }
    .heart::before{ left:-9px; top:0 }
    .heart::after{ top:-9px; left:0 }
    @keyframes floatHeart{
      0%{ transform: translate(-50%,-50%) rotate(45deg) scale(.9); opacity:.95 }
      80%{ opacity:.8 }
      100%{ transform: translate(-50%,-180%) rotate(45deg) scale(1.6); opacity:0 }
    }

    /* Print */
    @media print{ body{background:#fff} .actions,.meta,.ribbon{display:none} .card{box-shadow:none; border:1px solid #e5e7eb} }

    /* Dark mode */
    @media (prefers-color-scheme: dark){
      :root{ --card:#0b1220; --fg:#e5e7eb }
      .card{box-shadow:0 12px 36px rgba(0,0,0,.45)}
      .content{background: linear-gradient(180deg, #0f172a, #0b1220); border-color:#1f2937}
      blockquote,.lead{color:#e5e7eb}
      .badge{background:#0b1220; border-color:#1f2937; color:#e5e7eb}
      .btn.secondary{background:#0b1220; color:#e5e7eb; border-color:#1f2937}
      .url-input{background:#0b1220; color:#e5e7eb; border-color:#1f2937}
      .url-input:focus{border-color:#f472b6}
    }
  </style>
</head>
<body>
  <!-- Overlays -->
  <canvas id="confetti" aria-hidden="true"></canvas>
  <div id="heart-layer" aria-hidden="true"></div>

  <div class="wrap">
    <article class="card" role="article" aria-live="polite">
      <div class="ribbon" aria-hidden="true"></div>

      <header>
        <div class="avatar" id="avatar">L</div>
        <div class="titles">
          <div class="eyebrow">M√≥n qu√† nh·ªè d√†nh ri√™ng cho Linh</div>
          <h1>Ch√∫c m·ª´ng sinh nh·∫≠t Linh</h1>
          <div class="toLine" id="toLine">G·ª≠i <strong id="toName">Linh</strong> iu d·∫•u,</div>
        </div>
      </header>

      <section class="content">
        <blockquote id="wish">
          Trong ng√†y ƒë·∫∑c bi·ªát n√†y, anh ch√∫c em th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, b√¨nh an v√† ni·ªÅm vui ƒë·ªß ƒë·∫ßy.
          Mong r·∫±ng m·ªçi c·ªë g·∫Øng c·ªßa em ƒë·ªÅu n·ªü hoa, v√† m·ªói s·ªõm mai ƒë·ªÅu b·∫Øt ƒë·∫ßu b·∫±ng n·ª• c∆∞·ªùi.
          C·∫£m ∆°n em v√¨ ƒë√£ lu√¥n t·ª≠ t·∫ø v√† truy·ªÅn nƒÉng l∆∞·ª£ng t√≠ch c·ª±c cho nh·ªØng ng∆∞·ªùi xung quanh. üéÇ‚ú®
        </blockquote>
        <p class="lead" id="extra">
          N·∫øu c√≥ ƒëi·ªÅu ∆∞·ªõc, anh ∆∞·ªõc nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t lu√¥n t√¨m ƒë·∫øn em ‚Äì kh√¥ng ch·ªâ h√¥m nay,
          m√† trong t·ª´ng b∆∞·ªõc ƒë∆∞·ªùng ph√≠a tr∆∞·ªõc. H√£y v·ªØng tin v√† ti·∫øp t·ª•c t·ªèa s√°ng nh√©!
        </p>

        <div class="badges">
          <span class="badge">üíñ Lu√¥n ƒë∆∞·ª£c y√™u th∆∞∆°ng</span>
          <span class="badge">üçÄ B√¨nh an & may m·∫Øn</span>
          <span class="badge">üéØ M·ªçi d·ª± ƒë·ªãnh thu·∫≠n l·ª£i</span>
          <span class="badge">üåô Ng·ªß ngon v√† m∆° ƒë·∫πp</span>
        </div>

        <div class="signature">
          <div class="sig-name" id="fromSign">‚Äî Linh</div>
          <div class="sig-note" id="sigNote">Em iu c·ªßa Anh üíï</div>
        </div>

        <div class="actions">
          <button class="btn" id="shareBtn">Chia s·∫ª thi·ªáp</button>
          <button class="btn secondary" id="copyBtn">Sao ch√©p l·ªùi ch√∫c</button>
          <button class="btn ghost" id="printBtn">In thi·ªáp / L∆∞u PDF</button>
          <button class="btn secondary" id="confettiBtn">Ph√°o gi·∫•y üéä</button>
          <button class="btn" id="heartsBtn">Hi·ªáu ·ª©ng tr√°i tim üíó</button>
          <button class="btn ghost" id="musicBtn">Ph√°t nh·∫°c üéµ</button>
<!--           <input type="url" id="musicUrl" class="url-input" placeholder="D√°n link .mp3/.m4a/.ogg v√†o ƒë√¢y"> -->
          <button class="btn secondary" id="applyMusic">√Åp d·ª•ng nh·∫°c</button>
        </div>

        <!-- <p class="meta">M·∫πo: th√™m <code>?to=Ten&from=Linh&music=LINK.mp3</code> v√†o URL ƒë·ªÉ c√° nh√¢n h√≥a. N·∫øu ngu·ªìn ch·∫∑n CORS, h√£y d√πng link tr·ª±c ti·∫øp t·ªõi file audio.</p>
        Audio online/offline; src ƒë∆∞·ª£c g√°n b·∫±ng JS -->
        <audio id="music" preload="none" src="" playsinline></audio>
      </section>
    </article>
  </div>

  <script>
    // ===== Helpers & URL Params =====
    const qs = (s, r=document) => r.querySelector(s);
    const url = new URL(location.href);
    const toParam    = url.searchParams.get('to');
    const fromParam  = url.searchParams.get('from');
    const msgParam   = url.searchParams.get('msg');
    const musicParam = url.searchParams.get('music');

    const toNameEl   = qs('#toName');
    const toLineEl   = qs('#toLine');
    const wishEl     = qs('#wish');
    const fromSignEl = qs('#fromSign');
    const sigNoteEl  = qs('#sigNote');
    const avatarEl   = qs('#avatar');

    const defaultFrom = 'Linh';
    function initials(name){ return name.trim().split(/\s+/).slice(0,2).map(p=>p[0]?.toUpperCase()||'').join(''); }

    if (toParam){
      toNameEl.textContent = toParam;
      toLineEl.innerHTML = `G·ª≠i <strong id="toName">${toParam}</strong> th√¢n m·∫øn,`;
    }
    const sender = (fromParam && fromParam.trim()) ? fromParam.trim() : defaultFrom;
    fromSignEl.textContent = `‚Äî ${sender}`;
    avatarEl.textContent = initials(sender) || 'L';
    if (!fromParam){ sigNoteEl.textContent = 'B·∫°n g√°i c·ªßa b·∫°n üíï'; }
    if (msgParam){ wishEl.textContent = msgParam; }

    // ===== Confetti (nh·∫π & tinh t·∫ø) =====
    const canvas = qs('#confetti'); 
    const ctx = canvas.getContext('2d');
    let dpr = Math.max(1, window.devicePixelRatio || 1), pieces = [], animId=null;
    function sizeCanvas(){ canvas.width = Math.floor(innerWidth * dpr); canvas.height = Math.floor(innerHeight * dpr); }
    sizeCanvas(); addEventListener('resize', sizeCanvas);

    const COLORS = ['#e11d48','#fb7185','#f59e0b','#38bdf8','#94a3b8'];
    const rand = (a,b)=>Math.random()*(b-a)+a;

    function addPiece(x, y){
      const s = rand(5,10);
      pieces.push({
        x:x*dpr,y:y*dpr,w:s,h:s*rand(.6,1.1),
        vx:rand(-1.8,1.8)*dpr, vy:rand(-6,-3)*dpr, ay:rand(.08,.18)*dpr,
        rot:rand(0,Math.PI*2), vr:rand(-.12,.12),
        c:COLORS[(Math.random()*COLORS.length)|0], life:0, ttl:rand(80,120)
      });
    }
    function burst(x = innerWidth/2, y = innerHeight/3){
      const count = Math.min(120, Math.floor(innerWidth/9));
      for(let i=0;i<count;i++) addPiece(x+rand(-24,24), y+rand(-12,12));
      if (!animId) animate();
    }
    function animate(){
      animId = requestAnimationFrame(animate);
      ctx.clearRect(0,0,canvas.width, canvas.height);
      ctx.save(); ctx.scale(1/dpr, 1/dpr);
      for (let i = pieces.length-1; i>=0; i--){
        const p = pieces[i]; p.vy += p.ay; p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life++;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        ctx.fillStyle = p.c; ctx.globalAlpha = Math.max(0,1 - p.life/p.ttl);
        ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
        ctx.restore();
        if (p.life>p.ttl || p.y > canvas.height + 60*dpr) pieces.splice(i,1);
      }
      ctx.restore();
      if (!pieces.length){ cancelAnimationFrame(animId); animId=null; }
    }
    setTimeout(()=>burst(), 500);
    addEventListener('pointerdown', e => {
      burst(e.clientX, e.clientY);
      // th√™m v√†i tr√°i tim t·∫°i ƒëi·ªÉm ch·∫°m
      for (let i=0;i<4;i++){
        const dx = (Math.random()-0.5)*24;
        const dy = (Math.random()-0.5)*24;
        spawnHeart(e.clientX + dx, e.clientY + dy, 16 + Math.random()*8);
      }
    });

    // ===== Heart effects =====
    const heartLayer = qs('#heart-layer');
    const heartColors = ['#e11d48','#fb7185','#f472b6','#fda4af'];
    function spawnHeart(x, y, size=18){
      const h = document.createElement('div');
      h.className = 'heart';
      h.style.left = x + 'px';
      h.style.top  = y + 'px';
      h.style.width = size + 'px';
      h.style.height = size + 'px';
      h.style.color = heartColors[(Math.random()*heartColors.length)|0];
      h.style.animationDuration = (1.8 + Math.random()*1.4) + 's';
      h.style.filter = `drop-shadow(0 3px 6px rgba(225,29,72,${0.25+Math.random()*0.2}))`;
      heartLayer.appendChild(h);
      h.addEventListener('animationend', ()=> h.remove());
    }

    // gentle bottom-up heart rain
    let heartRainTimer = null;
    function startHeartRain(){
      if (heartRainTimer) return;
      heartRainTimer = setInterval(()=>{
        const x = Math.random() * innerWidth;
        const y = innerHeight - 10;
        spawnHeart(x, y, 14 + Math.random()*10);
      }, 260);
    }
    function stopHeartRain(){ clearInterval(heartRainTimer); heartRainTimer = null; }

    // B·∫≠t m∆∞a tim m·∫∑c ƒë·ªãnh
    startHeartRain();

    // Toggle hearts
    const heartsBtn = qs('#heartsBtn');
    let heartsOn = true;
    function updateHeartsLabel(){ heartsBtn.textContent = heartsOn ? 'T·∫Øt m∆∞a tim üíó' : 'Hi·ªáu ·ª©ng tr√°i tim üíó'; }
    updateHeartsLabel();
    heartsBtn.addEventListener('click', ()=>{
      heartsOn = !heartsOn;
      if (heartsOn) startHeartRain(); else stopHeartRain();
      updateHeartsLabel();
    });

    // ===== Share / Copy / Print =====
    qs('#confettiBtn').addEventListener('click', ()=> burst());
    qs('#printBtn').addEventListener('click', ()=> window.print());

    qs('#copyBtn').addEventListener('click', async ()=>{
      const msg = `${qs('#toLine').textContent}\n\n${qs('#wish').textContent}\n\n${qs('#extra').textContent}\n\n${qs('#fromSign').textContent}\n${qs('#sigNote').textContent}`;
      try{ await navigator.clipboard.writeText(msg); alert('ƒê√£ sao ch√©p l·ªùi ch√∫c!'); }
      catch{ prompt('Sao ch√©p th·ªß c√¥ng:', msg); }
    });

    qs('#shareBtn').addEventListener('click', async ()=>{
      const text = `${qs('#toLine').textContent}\n\n${qs('#wish').textContent}\n\n${qs('#extra').textContent}\n\n${qs('#fromSign').textContent}  ‚Ä¢  ${qs('#sigNote').textContent}`;
      const shareData = { title:'Thi·ªáp sinh nh·∫≠t', text, url: location.href };
      try{
        if (navigator.share){ await navigator.share(shareData); }
        else{ await navigator.clipboard.writeText(text + '\n' + location.href); alert('ƒê√£ sao ch√©p ƒë·ªÉ d√°n v√†o Messenger/Zalo!'); }
      }catch(e){ console.log(e); }
    });

    // ===== Music (online/offline) =====
    const music     = qs('#music');
    const musicBtn  = qs('#musicBtn');
    const musicUrlInput = qs('#musicUrl');
    const applyMusicBtn = qs('#applyMusic');

    const defaultSrc = 'happy-birthday.mp3';          
    const savedSrc   = localStorage.getItem('hb_music_src');

    function setMusicSrc(src){
      if(!src) return;
      try{
        music.src = src; music.load();
        localStorage.setItem('hb_music_src', src);
        musicBtn.textContent = 'Ph√°t nh·∫°c üéµ'; 
      }catch(e){
        alert('Link nh·∫°c kh√¥ng h·ª£p l·ªá ho·∫∑c b·ªã ch·∫∑n.');
      }
    }

    setMusicSrc(musicParam || savedSrc || defaultSrc);

    if (applyMusicBtn){
      applyMusicBtn.addEventListener('click', ()=>{
        const v = (musicUrlInput.value || '').trim();
        const ok = /^https?:\/\/.+\.(mp3|m4a|aac|ogg)(\?.*)?$/i.test(v);
        if(!ok){ alert('H√£y d√°n link TR·ª∞C TI·∫æP t·ªõi file .mp3/.m4a/.ogg'); return; }
        setMusicSrc(v);
        alert('ƒê√£ ƒë·ªïi nh·∫°c! B·∫•m ‚ÄúPh√°t nh·∫°c üéµ‚Äù ƒë·ªÉ nghe.');
      });
    }

    musicBtn.addEventListener('click', async ()=>{
      try{
        if (music.paused){ await music.play(); musicBtn.textContent='T·∫°m d·ª´ng nh·∫°c ‚è∏Ô∏è'; }
        else { music.pause(); musicBtn.textContent='Ph√°t nh·∫°c üéµ'; }
      }catch{
        alert('Kh√¥ng ph√°t ƒë∆∞·ª£c nh·∫°c. Link c√≥ th·ªÉ b·ªã ch·∫∑n cross-origin ho·∫∑c y√™u c·∫ßu thao t√°c ng∆∞·ªùi d√πng.');
      }
    });

   
    document.addEventListener('visibilitychange', ()=>{
      if (document.hidden) { pieces.length = 0; }
    });
  </script>
</body>
</html>
